---
const password = process.env.SITE_PASSWORD || import.meta.env.SITE_PASSWORD;
let error = false;

if (Astro.request.method === "POST") {
    const formData = await Astro.request.formData();
    const input = formData.get("password");

    if (input === password) {
        Astro.cookies.set("portfolio_session", password as string, {
            path: "/",
            httpOnly: true,
            secure: true,
            sameSite: "strict",
            maxAge: 60 * 60 * 24 * 7, // 1 week
        });
        return Astro.redirect("/");
    } else {
        error = true;
    }
}
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Confidential â€” KC Wolff-Ingham</title>
        <meta name="robots" content="noindex, nofollow" />
        <link rel="icon" href="/favicon.png" />
        <link rel="preconnect" href="https://fonts.googleapis.com" />
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link
            href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400&family=Source+Sans+3:wght@300;400&family=JetBrains+Mono&display=swap"
            rel="stylesheet"
        />
        <style>
            :root {
                --bg: #e8e6e1;
                --accent: #70541c;
                --doc-heading: #1a1a1a;
                --display: "Cormorant Garamond", Georgia, serif;
                --doc-sans: "Source Sans 3", -apple-system, sans-serif;
                --mono: "JetBrains Mono", monospace;
            }

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: var(--doc-sans);
                background: var(--bg);
                color: var(--doc-heading);
                height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                -webkit-font-smoothing: antialiased;
                overflow: hidden;
            }

            .login-container {
                max-width: 360px;
                width: 100%;
                padding: 40px 32px;
                text-align: center;
                opacity: 0;
                transform: translateY(16px);
                animation: reveal 0.9s cubic-bezier(0.22, 1, 0.36, 1) forwards;
            }

            @keyframes reveal {
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .logo {
                font-family: var(--display);
                font-size: 44px;
                font-weight: 300;
                letter-spacing: 0.02em;
                line-height: 1.1;
                color: var(--doc-heading);
                margin-bottom: 14px;
            }

            .logo span {
                display: block;
                font-family: var(--doc-sans);
                font-size: 11px;
                font-weight: 400;
                text-transform: uppercase;
                letter-spacing: 0.28em;
                margin-top: 14px;
                color: rgba(0, 0, 0, 0.42);
            }

            .divider {
                width: 24px;
                height: 1px;
                background: var(--accent);
                margin: 28px auto 32px;
            }

            form {
                display: flex;
                flex-direction: column;
                gap: 14px;
            }

            .input-wrapper {
                position: relative;
            }

            input {
                width: 100%;
                padding: 13px 0;
                background: transparent;
                border: none;
                border-bottom: 1px solid rgba(0, 0, 0, 0.25);
                font-family: var(--doc-sans);
                font-size: 15px;
                text-align: center;
                outline: none;
                transition: border-color 0.25s ease;
                color: var(--doc-heading);
            }

            input:focus {
                border-bottom-color: var(--accent);
            }

            input::placeholder {
                color: rgba(0, 0, 0, 0.35);
                font-style: italic;
                opacity: 1;
            }

            button {
                align-self: center;
                background: var(--accent);
                color: white;
                border: none;
                padding: 11px 40px;
                font-family: var(--doc-sans);
                font-size: 11px;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 2.5px;
                cursor: pointer;
                transition: background 0.25s ease, opacity 0.25s ease;
                margin-top: 8px;
            }

            button:hover {
                background: #5a4316;
                opacity: 0.92;
            }

            .error-msg {
                font-family: var(--mono);
                font-size: 10px;
                color: #c8102e;
                margin-top: 8px;
                text-transform: uppercase;
                letter-spacing: 1px;
            }

            .footer {
                position: fixed;
                bottom: 36px;
                font-size: 10px;
                color: rgba(0, 0, 0, 0.38);
                text-transform: uppercase;
                letter-spacing: 2px;
            }
        </style>
    </head>
    <body>
        <div class="login-container">
            <div class="logo">
                KC Wolff-Ingham
                <span>Resume and Selected Work</span>
            </div>

            <div class="divider"></div>

            <form method="POST">
                <div class="input-wrapper">
                    <input
                        type="password"
                        name="password"
                        placeholder="Enter access code"
                        required
                        autofocus
                    />
                </div>
                <button type="submit">Unlock Access</button>
                {
                    error && (
                        <p class="error-msg">
                            Incorrect access code. Please try again.
                        </p>
                    )
                }
            </form>
        </div>

        <div class="footer">Confidential &mdash; KC Wolff-Ingham</div>
    </body>
</html>
